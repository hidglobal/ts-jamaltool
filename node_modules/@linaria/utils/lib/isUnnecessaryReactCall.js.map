{"version":3,"file":"isUnnecessaryReactCall.js","names":["getCallee","p","callee","get","isSequenceExpression","expressions","length","isNumericLiteral","value","JSXRuntimeSource","isJSXRuntime","imports","jsxRuntime","find","i","source","jsxRuntimeName","local","isIdentifier","node","name","isMemberExpression","isHookOrCreateElement","test","isClassicReactRuntime","reactImports","filter","imported","bindingPath","getScope","getBinding","path","some","isAncestor","object","property","defaultImport","isUnnecessaryReactCall","programPath","findParent","isProgram","collectExportsAndImports"],"sources":["../src/isUnnecessaryReactCall.ts"],"sourcesContent":["import type { NodePath } from '@babel/core';\nimport type { CallExpression } from '@babel/types';\n\nimport type { IImport, ISideEffectImport } from './collectExportsAndImports';\nimport collectExportsAndImports from './collectExportsAndImports';\nimport { getScope } from './getScope';\n\nfunction getCallee(p: NodePath<CallExpression>) {\n  const callee = p.get('callee');\n  if (callee.isSequenceExpression()) {\n    const expressions = callee.get('expressions');\n    if (\n      expressions.length === 2 &&\n      expressions[0].isNumericLiteral({ value: 0 })\n    ) {\n      return expressions[1];\n    }\n\n    return callee;\n  }\n\n  return callee;\n}\n\nconst JSXRuntimeSource = 'react/jsx-runtime';\n\nfunction isJSXRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  const jsxRuntime = imports.find((i) => i.source === JSXRuntimeSource);\n  const jsxRuntimeName =\n    jsxRuntime?.local?.isIdentifier() && jsxRuntime?.local?.node?.name;\n\n  if (jsxRuntime) {\n    const callee = getCallee(p);\n    if (jsxRuntimeName && callee.isIdentifier({ name: jsxRuntimeName })) {\n      return true;\n    }\n\n    if (\n      callee.isMemberExpression() &&\n      imports.find((i) => i.source === JSXRuntimeSource && i.local === callee)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction isHookOrCreateElement(name: string): boolean {\n  return name === 'createElement' || /use[A-Z]/.test(name);\n}\n\nfunction isClassicReactRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  const reactImports = imports.filter(\n    (i) =>\n      i.source === 'react' &&\n      (i.imported === 'default' ||\n        (i.imported && isHookOrCreateElement(i.imported)))\n  ) as IImport[];\n\n  if (reactImports.length === 0) return false;\n  const callee = getCallee(p);\n  if (callee.isIdentifier() && isHookOrCreateElement(callee.node.name)) {\n    const bindingPath = getScope(callee).getBinding(callee.node.name)?.path;\n    return reactImports.some((i) => bindingPath?.isAncestor(i.local));\n  }\n\n  if (callee.isMemberExpression()) {\n    if (reactImports.some((i) => i.local === callee)) {\n      // It's React.createElement in CJS\n      return true;\n    }\n\n    const object = callee.get('object');\n    const property = callee.get('property');\n    const defaultImport = reactImports.find((i) => i.imported === 'default');\n    if (\n      !defaultImport ||\n      !defaultImport.local.isIdentifier() ||\n      !property.isIdentifier() ||\n      !isHookOrCreateElement(property.node.name) ||\n      !object.isIdentifier({ name: defaultImport.local.node.name })\n    ) {\n      return false;\n    }\n\n    const bindingPath = getScope(object).getBinding(object.node.name)?.path;\n    return bindingPath?.isAncestor(defaultImport.local) ?? false;\n  }\n\n  return false;\n}\n\nexport default function isUnnecessaryReactCall(path: NodePath<CallExpression>) {\n  const programPath = path.findParent((p) => p.isProgram());\n  if (!programPath) {\n    return false;\n  }\n\n  const { imports } = collectExportsAndImports(programPath);\n\n  return isJSXRuntime(path, imports) || isClassicReactRuntime(path, imports);\n}\n"],"mappings":"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"}